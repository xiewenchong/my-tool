<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>例3</title>
    <meta name="viewport" content="initial-scale=1, maximum-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta content="telephone=no" name="format-detection">
    <meta content="email=no" name="format-detection">

    <style type="text/css">
    	.content {
    		padding: 20px;
    		font-size: 16px;
    		text-align: center;
    	}

    	div {
	        height: 50px;
	        width: 50px;
	        float: left;
	        margin-right: 10px;
	        display: none;
	        background-color: #090;
	        opacity: 1;
	    }
    </style>
</head>

<body>
	<section class="content"></section>

	<button>Go</button>
    <p>Ready...</p>
    <div></div>
    <div></div>
    <div></div>
    <div></div>

	<script src="js/jquery.min.js"></script>
	<script>
		function c(m) {
			$('.content').append(m + '<br/>');
			console.log(m);
		}

		/*var promise = new Promise(function(resolve, reject) {
			if(true) {
				resolve('done');
			}else {
				reject('failed');
			}
		});

		promise.then(function(data) {
			console.log(data);
		}, function(data) {
			console.log(data);
		});*/

		/*$('button').on('click', function() {
            $('p').append('Started...');

            var arr = [],

                getDtd = function() {
                    $('div').each(function(i) {
                        var $this = $(this),
                        	promise = new Promise(function(resolve, reject) {

                        		$this.css({
		                            display: 'block'
		                        }).animate({
		                            opacity: 0,
		                        }, 1000 * (i + 1), function() {
		                            $this.css({
		                                display: 'none'
		                            });
		                            resolve();
		                        });

	                        });

                        arr.push(promise);
                    });

                    return arr;
                };

			Promise.all(getDtd()).then(function() {
                $('p').append(' Finished! ');
            });
        });*/

        /*Promise.prototype.finally = function (callback) {
		  let P = this.constructor;
		  return this.then(
		    value  => P.resolve(callback()).then(() => value),
		    reason => P.resolve(callback()).then(() => { throw reason; })
		  );
		};

        var a1 = new Promise(function(resolve, reject) {
        	return resolve($.ajax('test1.html'));
        });

        var a2 = new Promise(function(resolve, reject) {
        	return resolve($.ajax('test2.html'));
        });

        Promise.all([a1, a2])
		.then(function(a, b){ 
			alert('哈哈，成功了！');
		}, function(){
			alert('出错啦！');
		})
		.finally(function() {
			alert('总是执行');
		});*/



		/*new Promise(function(resolve, reject) {
			$.ajax('test1.html')
			.then(function(a) {
				return resolve(a);
			}, function(a) {
				return reject(a);
			});
		}).then(function(a) {
			$.ajax('test2.html')
			.then(function(b) {
				console.log(a, b);
			});
		});*/

		/*var src = 'http://pic1.win4000.com/wallpaper/9/58aa9f3231b88.jpg',
			preloadImage = function (path) {
			return new Promise(function (resolve, reject) {
				var image = new Image();
				image.onload  = resolve;
				image.onerror = reject;
				image.src = path;
			});
		};

		c('start...');

		preloadImage(src)
		.then(function() {
			$('body').append('<img src=' + src + ' width="300" height="300">');
			c('finished...');
		});*/


		/*var promise = Promise.resolve($.ajax('test1.html'));

		promise.then(function(a) {
			c(a);
		});*/

		/*var fn = async function() {
			var a = await $.ajax('test1.html'),
				b = await $.ajax('test2.html');

			return Promise.resolve([a,b]);
		}

		fn().then(function(a, b) {
			c(a, b);
		});*/
	</script>
</body>
</html>